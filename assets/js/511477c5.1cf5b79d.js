"use strict";(self.webpackChunkcaspardb=self.webpackChunkcaspardb||[]).push([[76],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>v});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(n),m=r,v=c["".concat(s,".").concat(m)]||c[m]||d[m]||l;return n?a.createElement(v,i(i({ref:t},p),{},{components:n})):a.createElement(v,i({ref:t},p))}));function v(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o[c]="string"==typeof e?e:r,i[1]=o;for(var u=2;u<l;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},7793:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>o,toc:()=>u});var a=n(7462),r=(n(7294),n(3905));const l={title:"Server Side Template Injection (SSTI) Flask",sidebar_label:"SSTI",pagination_label:"SSTI Flask",description:"SSTI Flask",keywords:["docs","injection","SSTI","Red Team","Flask","Python","Web"]},i=void 0,o={unversionedId:"redteam/Attaques Web/SSTI Flask",id:"redteam/Attaques Web/SSTI Flask",title:"Server Side Template Injection (SSTI) Flask",description:"SSTI Flask",source:"@site/docs/20-redteam/02-Attaques Web/02-SSTI Flask.md",sourceDirName:"20-redteam/02-Attaques Web",slug:"/redteam/Attaques Web/SSTI Flask",permalink:"/azurwiki/redteam/Attaques Web/SSTI Flask",draft:!1,editUrl:"https://github.com/haysberg/azurwiki/tree/main/docs/docs/20-redteam/02-Attaques Web/02-SSTI Flask.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Server Side Template Injection (SSTI) Flask",sidebar_label:"SSTI",pagination_label:"SSTI Flask",description:"SSTI Flask",keywords:["docs","injection","SSTI","Red Team","Flask","Python","Web"]},sidebar:"tutorialSidebar",previous:{title:"XSS, k\xe9sako ?",permalink:"/azurwiki/redteam/Attaques Web/XSS"},next:{title:"Obtenir un shell propre",permalink:"/azurwiki/redteam/clean-shell"}},s={},u=[{value:"Qu&#39;est ce qu&#39;une injection via template ?",id:"quest-ce-quune-injection-via-template-",level:2},{value:"Introduction",id:"introduction",level:3},{value:"Mais d&#39;o\xf9 vient cette vuln\xe9rabilit\xe9 ?",id:"mais-do\xf9-vient-cette-vuln\xe9rabilit\xe9-",level:3},{value:"Payload simple",id:"payload-simple",level:3},{value:"Exploitation avanc\xe9e",id:"exploitation-avanc\xe9e",level:3},{value:"Rem\xe9diation et conclusion",id:"rem\xe9diation-et-conclusion",level:3}],p={toc:u},c="wrapper";function d(e){let{components:t,...n}=e;return(0,r.kt)(c,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h2",{id:"quest-ce-quune-injection-via-template-"},"Qu'est ce qu'une injection via template ?"),(0,r.kt)("h3",{id:"introduction"},"Introduction"),(0,r.kt)("p",null,"L'attaque par Server Side Template Injection, commun\xe9ment appel\xe9e SSTI, est une attaque qui est pratiqu\xe9e sur des applications web utilisant des moteurs de templates c\xf4t\xe9 serveur. Elle permet \xe0 un attaquant d'injecter du code malveillant dans les templates utilis\xe9s par l'application, ce qui peut conduire \xe0 l'ex\xe9cution de code arbitraire sur le serveur."),(0,r.kt)("p",null,"Il existe plusieurs moteurs de templates populaires, tels que Jinja2 pour Python (utilis\xe9 par Flask), Twig pour PHP, et EJS pour Node.js. Chaque moteur de template a ses propres vuln\xe9rabilit\xe9s potentielles, mais le principe g\xe9n\xe9ral de l'attaque SSTI reste le m\xeame."),(0,r.kt)("p",null,"Ici nous allons nous concentrer sur Flask et son moteur de template Jinja2."),(0,r.kt)("h3",{id:"mais-do\xf9-vient-cette-vuln\xe9rabilit\xe9-"},"Mais d'o\xf9 vient cette vuln\xe9rabilit\xe9 ?"),(0,r.kt)("p",null,"La vuln\xe9rabilit\xe9 survient quand les donn\xe9es que fournit l'utilisateur sont directement \xe9valu\xe9es par le moteur de template sans aucune validation ou assainissement. Regardons un exemple simple en Flask :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"@app.route('/')\ndef index():\n    name = request.args.get('name', 'World')\n    template = f\"<h1>Bonjour, {name} !</h1>\"\n    return render_template_string(template)\n")),(0,r.kt)("p",null,"Ce template est vuln\xe9rable car le d\xe9veloppeur injecte directement dans le template la variable ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," qui provient de l'utilisateur. Un attaquant pourrait exploiter cette vuln\xe9rabilit\xe9 en fournissant une valeur malveillante pour ",(0,r.kt)("inlineCode",{parentName:"p"},"name"),"."),(0,r.kt)("p",null,"Bien souvent l'utilisateur ne voit pas le code c\xf4t\xe9 serveur, nous allons donc tester des payloads simples pour voir si le serveur est vuln\xe9rable \xe0 ce genre de faille."),(0,r.kt)("h3",{id:"payload-simple"},"Payload simple"),(0,r.kt)("p",null,"Voici un payload simple pour tester la vuln\xe9rabilit\xe9 :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{{7*7}}\n")),(0,r.kt)("p",null,"Si le serveur est vuln\xe9rable, il renverra ",(0,r.kt)("inlineCode",{parentName:"p"},"49")," dans la r\xe9ponse HTTP. Sinon, il affichera simplement ",(0,r.kt)("inlineCode",{parentName:"p"},"{{7*7}}"),"."),(0,r.kt)("h3",{id:"exploitation-avanc\xe9e"},"Exploitation avanc\xe9e"),(0,r.kt)("p",null,"Une fois que nous avons confirm\xe9 que le serveur est vuln\xe9rable, nous pouvons exploiter la faille. Nous avons acc\xe8s au langage Python, ce qui va nous permettre d'ex\xe9cuter des commandes syst\xe8me.\nDans la commande si dessous, nous utilisons la fonction ",(0,r.kt)("inlineCode",{parentName:"p"},"__import__")," pour importer le module ",(0,r.kt)("inlineCode",{parentName:"p"},"os"),", puis nous utilisons ",(0,r.kt)("inlineCode",{parentName:"p"},"popen")," pour ex\xe9cuter des commandes linux.\nVoici un exemple de payload pour lister les fichiers du r\xe9pertoire courant :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"{{ self.__init__.__globals__.__builtins__.__import__('os').popen('ls').read() }}\n")),(0,r.kt)("h3",{id:"rem\xe9diation-et-conclusion"},"Rem\xe9diation et conclusion"),(0,r.kt)("p",null,"Voici un code permettant de se prot\xe9ger contre les attaques SSTI en Flask :"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-python"},"@app.route('/safe')\ndef safe():\n    user_input = request.args.get('name', 'invit\xe9')\n    template = \"\"\"\n    <h1>Bonjour, {{ name }}</h1>\n    <p>Votre entr\xe9e s\xe9curis\xe9e : {{ name }}</p>\n    \"\"\"\n    return render_template_string(template, name=user_input)\n")),(0,r.kt)("p",null,"Nous utilisons des variables pour passer les donn\xe9es utilisateur au template, ce qui emp\xeache l'injection de payload."),(0,r.kt)("p",null,"En conclusion, les attaques SSTI sont une porte d'entr\xe9e des applications web utilisant des moteurs de templates. Cette faille ressemble grandement \xe0 des failles de type injection et il est crucial de ne jamais faire confiance aux entr\xe9es utilisateur. Toujours valider les donn\xe9es avant de les utiliser dans des templates."))}d.isMDXComponent=!0}}]);