"use strict";(self.webpackChunkcaspardb=self.webpackChunkcaspardb||[]).push([[56],{3905:(e,n,r)=>{r.d(n,{Zo:()=>p,kt:()=>v});var t=r(7294);function i(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function o(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){i(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,t,i=function(e,n){if(null==e)return{};var r,t,i={},a=Object.keys(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||(i[r]=e[r]);return i}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(t=0;t<a.length;t++)r=a[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=t.createContext({}),u=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):o(o({},n),e)),r},p=function(e){var n=u(e.components);return t.createElement(l.Provider,{value:n},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),c=u(r),m=i,v=c["".concat(l,".").concat(m)]||c[m]||d[m]||a;return r?t.createElement(v,o(o({ref:n},p),{},{components:r})):t.createElement(v,o({ref:n},p))}));function v(e,n){var r=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var a=r.length,o=new Array(a);o[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var u=2;u<a;u++)o[u]=r[u];return t.createElement.apply(null,o)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},6088:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>d,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var t=r(7462),i=(r(7294),r(3905));const a={title:"Remplacer Netflix",sidebar_label:"Remplacer Netflix",pagination_label:"Remplacer Netflix",description:"Comment remplacer Netflix avec Jellyfin et la stack *arr ?",keywords:["docs","OSINT"]},o=void 0,s={unversionedId:"deploiement/netflix",id:"deploiement/netflix",title:"Remplacer Netflix",description:"Comment remplacer Netflix avec Jellyfin et la stack *arr ?",source:"@site/docs/50-deploiement/01-netflix.md",sourceDirName:"50-deploiement",slug:"/deploiement/netflix",permalink:"/azurwiki/deploiement/netflix",draft:!1,editUrl:"https://github.com/haysberg/azurwiki/tree/main/docs/docs/50-deploiement/01-netflix.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{title:"Remplacer Netflix",sidebar_label:"Remplacer Netflix",pagination_label:"Remplacer Netflix",description:"Comment remplacer Netflix avec Jellyfin et la stack *arr ?",keywords:["docs","OSINT"]},sidebar:"tutorialSidebar",previous:{title:"D\xe9ploiement",permalink:"/azurwiki/deploiement/"},next:{title:"D\xe9ployer un serveur Minecraft",permalink:"/azurwiki/deploiement/minecraft"}},l={},u=[{value:"Mat\xe9riel",id:"mat\xe9riel",level:2},{value:"Disque dur",id:"disque-dur",level:3},{value:"CPU / GPU",id:"cpu--gpu",level:3},{value:"Bande Passante",id:"bande-passante",level:3},{value:"Logiciels",id:"logiciels",level:2},{value:"qBitTorrent &amp; VPN",id:"qbittorrent--vpn",level:3},{value:"Sonarr &amp; Radarr",id:"sonarr--radarr",level:3},{value:"Jellyfin",id:"jellyfin",level:2}],p={toc:u},c="wrapper";function d(e){let{components:n,...a}=e;return(0,i.kt)(c,(0,t.Z)({},p,a,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Une capture d&#39;\xe9cran du logiciel jellyfin",src:r(4333).Z,width:"2557",height:"1279"})),(0,i.kt)("p",null,"Netflix, c'est bien mais c'est cher !"),(0,i.kt)("p",null,"On peut faire beaucoup mieux avec quelques containers et un serveur avec un peu de stockage ! Un serveur o\xf9 l'on pourrait avoir n'importe quelle s\xe9rie, o\xf9 votre maman pourrait demander un film en cliquant sur un bouton et l'avoir quelques minutes plus tard."),(0,i.kt)("h2",{id:"mat\xe9riel"},"Mat\xe9riel"),(0,i.kt)("p",null,"Tout ces logiciels, \xe7a pompe des ressources, alors voil\xe0 ce qu'il va vous falloir pour r\xe9ussir \xe0 h\xe9berger tout \xe7a."),(0,i.kt)("h3",{id:"disque-dur"},"Disque dur"),(0,i.kt)("p",null,"Il va vous falloir un ",(0,i.kt)("strong",{parentName:"p"},"GROS")," disque."),(0,i.kt)("p",null,"Concr\xe8tement, si vous en avez un qui traine et qui ne sers \xe0 rien \xe7a peut d\xe9panner, mais on d\xe9passe assez vite le stade du premier t\xe9raoctet quand on a quelques utilisateurs et qu'ils veulent commencer \xe0 vraiment se passer de Netflix."),(0,i.kt)("p",null,"Perso, nous avons tous un disque dur de + de 10 To et on arrive \xe0 s'en sortir, mais en dessous \xe7a devient compliqu\xe9 et il faudra faire pas mal de m\xe9nage."),(0,i.kt)("p",null,"Cela veut souvent dire remplacer des \xe9pisodes pour des versions + light, quitte \xe0 perdre en qualit\xe9 vid\xe9o, ou pire, supprimer du contenu de votre serveur."),(0,i.kt)("h3",{id:"cpu--gpu"},"CPU / GPU"),(0,i.kt)("p",null,"Le probl\xe8me avec la vid\xe9o, c'est que l'information peut \xeatre encod\xe9e de plein de mani\xe8res diff\xe9rentes : H264, H265, AV1, VP9... "),(0,i.kt)("p",null,"Le plus emb\xeatant, c'est que certaines machines ne parlent pas toutes le m\xeame \"langage\" de codec. C'est \xe0 ce moment-l\xe0 que votre serveur va devoir faire la traduction (transcoding). Le probl\xe8me, c'est qu'on parle de d\xe9coder et r\xe9-encoder une vid\xe9o \xe0 la vol\xe9e, donc \xe7a pompe pas mal de puissance de calcul."),(0,i.kt)("p",null,"Autant vous le dire tout de suite, si vous avez un raspberry Pi, vous pouvez oublier l'id\xe9e de faire du transcoding. Priez pour que vos utilisateurs se connectent depuis des clients compatibles."),(0,i.kt)("p",null,"Pour les autres, un CPU fait tr\xe8s bien l'affaire quand vous avez 3 ou 4 utilisateurs en m\xeame temps sur votre machine. Par contre, vous allez devoir vous pr\xe9parer \xe0 avoir des bruits de jet priv\xe9 \xe9manant de votre serveur \xe0 3H du mat' quand votre pote ch\xf4meur ira se mater GoT en 4K."),(0,i.kt)("p",null,"Si vous voulez avoir un peu plus de jus pour servir plus de clients en simultan\xe9, ou si vous ne voulez plus de bruit de jet priv\xe9 \xe0 3H du mat' il y a une solution simple : incorporer une carte graphique dans votre serveur pour que Jellyfin puisse l'utiliser."),(0,i.kt)("p",null,"Pour avoir plus d'infos sur ce sujet, vous pouvez ",(0,i.kt)("a",{parentName:"p",href:"https://jellyfin.org/docs/general/administration/hardware-acceleration/"},"consulter la doc de Jellyfin"),"."),(0,i.kt)("p",null,"Il est fortement recommand\xe9 de prendre une carte graphique Intel Arc A380, pour les raisons suivantes :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Des drivers int\xe9gr\xe9s au kernel Linux ce qui permet de ne pas se prendre la t\xeate avec leur installation"),(0,i.kt)("li",{parentName:"ul"},"Un support du AV1, ce qui permettra \xe0 vos utilisateurs de regarder leur contenu depuis un navigateur"),(0,i.kt)("li",{parentName:"ul"},"Un prix bas par rapport aux autres cartes graphiques avec le m\xeame set de codecs"),(0,i.kt)("li",{parentName:"ul"},"Une consommation \xe9lectrique faible qui permet de ne pas avoir besoin d'alim externe")),(0,i.kt)("h3",{id:"bande-passante"},"Bande Passante"),(0,i.kt)("p",null,"Tout d\xe9pend le nombre de personnes qui regardent du contenu en m\xeame temps sur votre instance. On vous conseille de tabler sur 10 Mbps par stream ",(0,i.kt)("em",{parentName:"p"},"minimum"),". Si jamais vous avez 30 Mbps d'upload avec votre abonnement Internet, vous ne pourrez donc pas envoyer + de 3 streams \xe0 la fois."),(0,i.kt)("p",null,"Du moment que vous avez un minimum d'upload, la question n'est pas de savoir si vous pourrez regarder des films, mais surtout avec combien de personnes vous pourrez partager votre instance."),(0,i.kt)("h2",{id:"logiciels"},"Logiciels"),(0,i.kt)("p",null,"La stack compl\xe8te utilis\xe9e pour g\xe9rer vos films est assez complexe et se compose de pas mal de services diff\xe9rents. Il est donc fortement recommand\xe9 de lire la partie du Wiki sur la configuration d'un ",(0,i.kt)("a",{parentName:"p",href:"/azurwiki/selfhost/caddy"},"reverse proxy")," et de ",(0,i.kt)("a",{parentName:"p",href:"/azurwiki/selfhost/docker"},"Docker")," avant de commencer si vous n'\xeates pas \xe0 l'aise avec ces sujets."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Il est assez complexe de bien configurer tous ces services, il est recommand\xe9 de lire le wiki ",(0,i.kt)("a",{parentName:"p",href:"https://trash-guides.info/"},"TRaSH Guides")," afin d'avoir plus d'informations sur comment configurer les diff\xe9rents logiciels ci-dessous.")),(0,i.kt)("h3",{id:"qbittorrent--vpn"},"qBitTorrent & VPN"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Une capture d&#39;\xe9cran du logiciel qBitTorrent",src:r(2034).Z,width:"1917",height:"965"})),(0,i.kt)("p",null,"qBitTorrent est un client BitTorrent open-source et disponible sur toutes les plateformes. Il est tr\xe8s complet, et offre une interface Web qui permet de le configurer en profondeur et de g\xe9rer vos torrents sans souci.\nIl existe d'autres alternatives, mais elles sont toutes assez limit\xe9es, c'est pourquoi tout le monde chez nous utilise qBit."),(0,i.kt)("p",null,"Afin d'\xe9viter de se faire taper sur les doigts par notre ami l'ARCOM, il va vous falloir un VPN, id\xe9alement un VPN qui pointe vers un autre pays.\nSi vous avez d\xe9j\xe0 un abonnement VPN, il va vous falloir trouver une image Docker pour pouvoir vous y connecter car le but de ce VPN est de cacher notre traffic BitTorrent."),(0,i.kt)("p",null,"\xc0 des fins d'illustrations, vous trouverez donc un exemple de configuration de qBitTorrent et Proton VPN dans un seul et m\xeame fichier ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose")," ci-dessous."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'---\nversion: "3.8"\nservices:\n  protonwire:\n    container_name: vpn\n    image: ghcr.io/tprasadtp/protonvpn:latest\n    init: true\n    restart: unless-stopped\n    privileged: true\n    environment:\n      PROTONVPN_SERVER: EX#99\n      WIREGUARD_PRIVATE_KEY: "CL\xc9_PRIV\xc9E_WIREGUARD"\n    # NET_ADMIN capability is mandatory!\n    cap_add:\n      - NET_ADMIN\n    # sysctl net.ipv4.conf.all.rp_filter is mandatory!\n    sysctls:\n      net.ipv4.conf.all.rp_filter: 2\n      net.ipv6.conf.all.disable_ipv6: 1\n    volumes:\n      - /etc/localtime:/etc/localtime:ro\n    ports:\n      - 127.0.0.1:6881:6881\n      - 127.0.0.1:6881:6881/udp\n      - 127.0.0.1:10020:10020\n      - 127.0.0.1:9091:9091\n      - 127.0.0.1:51413:51413\n      - 127.0.0.1:51413:51413/udp\n    devices:\n      - /dev/net/tun:/dev/net/tun\n    \n  qbittorrent:\n    image: lscr.io/linuxserver/qbittorrent:latest\n    container_name: qbit\n    depends_on:\n      - protonwire\n    userns_mode: host\n    network_mode: service:protonwire\n    restart: unless-stopped\n    environment:\n      - PUID=0\n      - PGID=0\n      - TZ=Europe/Paris\n      - WEBUI_PORT=10020\n    volumes:\n      - /containers/qbittorrent:/config:z\n      - stockage:/stockage:z\n')),(0,i.kt)("admonition",{type:"info"},(0,i.kt)("p",{parentName:"admonition"},"Il n'est pas n\xe9cessaire de cacher le reste de votre traffic. La lecture de contenu depuis votre instance Jellyfin n'est pas vuln\xe9rable.")),(0,i.kt)("h3",{id:"sonarr--radarr"},"Sonarr & Radarr"),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Une capture d&#39;\xe9cran du logiciel Radarr",src:r(7352).Z,width:"1918",height:"964"})),(0,i.kt)("p",null,"Sonarr et Radarr ont la m\xeame fonction : vous offrir une interface Web pour r\xe9ussir \xe0 g\xe9rer vos diff\xe9rents contenus en lan\xe7ant un t\xe9l\xe9chargement automatique pour un \xe9pisode de s\xe9rie, ou pour remplacer un film par une copie de meilleure qualit\xe9. Sonarr fonctionne pour les s\xe9ries (et animes) et Radarr pour les films."),(0,i.kt)("p",null,"Ces logiciels vont aller s'interfacer directement avec qBitTorrent et les diff\xe9rents indexeurs BitTorrents que vous avez renseign\xe9 pour vous permettre d'avoir une liste de tous les torrents disponibles pour une oeuvre, pour ensuite pouvoir l'ajouter \xe0 qBit en un clic, ce sont donc des logiciels dont vous ne pourrez plus vous passer une fois que votre biblioth\xe8que commencera \xe0 faire plus de quelques dizaines de giga-octets."),(0,i.kt)("p",null,"Voici un exemple de fichier ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose")," adapt\xe9 : "),(0,i.kt)("admonition",{title:"Duplication de fichiers",type:"danger"},(0,i.kt)("p",{parentName:"admonition"},"Pour \xe9viter que Sonarr et Radarr copient les fichiers au moment de l'import, au lieu de seulement cr\xe9er un lien symbolique vers ceux-ci (ce qui doublerait l'espace pris sur votre disque) il est fortement recommand\xe9 de mettre toute votre stack Jellyfin dans un seul et m\xeame fichier ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose"),".")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.8"\nservices:\n  prowlarr:\n    image: lscr.io/linuxserver/prowlarr:develop\n    container_name: prowlarr\n    environment:\n      - PUID=0\n      - PGID=0\n      - TZ=Europe/Paris\n    volumes:\n      - /containers/prowlarr:/config:z\n    ports:\n      - 127.0.0.1:9696:9696\n    restart: unless-stopped\n    \n  radarr:\n    image: lscr.io/linuxserver/radarr:latest\n    container_name: radarr\n    environment:\n      - PUID=0\n      - PGID=0\n      - TZ=Europe/Paris\n    volumes:\n      - /containers/radarr:/config:z\n      - stockage:/stockage:z\n    ports:\n      - 127.0.0.1:7878:7878\n    restart: unless-stopped\n    \n  sonarr:\n    image: lscr.io/linuxserver/sonarr:develop\n    container_name: sonarr\n    environment:\n      - PUID=0\n      - PGID=0\n      - TZ=Europe/Paris\n    volumes:\n      - /containers/sonarr:/config:z\n      - stockage:/stockage:z\n    ports:\n      - 127.0.0.1:8989:8989\n    restart: unless-stopped\n')),(0,i.kt)("h2",{id:"jellyfin"},"Jellyfin"),(0,i.kt)("p",null,"Jellyfin, c'est le logiciel que vous pouvez voir tout en haut de cette page. Il y a \xe9norm\xe9ment d'options diff\xe9rentes de disponible dans le logiciel, donc on va vous laisser aller piocher dedans vous-m\xeame."),(0,i.kt)("p",null,"Quelques recommandations n\xe9anmoins :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Pour Android, il est recommand\xe9 d'utiliser ",(0,i.kt)("a",{parentName:"li",href:"https://play.google.com/store/apps/details?id=dev.jdtech.jellyfin&pli=1"},"Findroid")),(0,i.kt)("li",{parentName:"ul"},"Pour iOS / iPadOS / Apple TV, ",(0,i.kt)("a",{parentName:"li",href:"https://apps.apple.com/fr/app/swiftfin/id1604098728"},"Swiftfin"))),(0,i.kt)("p",null,"Voici donc le ",(0,i.kt)("inlineCode",{parentName:"p"},"docker-compose")," que vous devriez obtenir \xe0 la fin :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},'---\nversion: "3.8"\nservices:              \n  radarr:\n    image: lscr.io/linuxserver/radarr:latest\n    container_name: radarr\n    environment:\n      - PUID=0\n      - PGID=0\n      - TZ=Europe/Paris\n    volumes:\n      - /containers/radarr:/config:z\n      - stockage:/stockage:z\n    ports:\n      - 127.0.0.1:7878:7878\n    restart: unless-stopped\n    \n  sonarr:\n    image: lscr.io/linuxserver/sonarr:develop\n    container_name: sonarr\n    environment:\n      - PUID=0\n      - PGID=0\n      - TZ=Europe/Paris\n    volumes:\n      - /containers/sonarr:/config:z\n      - stockage:/stockage:z\n    ports:\n      - 127.0.0.1:8989:8989\n    restart: unless-stopped\n\n  protonwire:\n    container_name: vpn\n    image: ghcr.io/tprasadtp/protonvpn:latest\n    init: true\n    restart: unless-stopped\n    privileged: true\n    environment:\n      PROTONVPN_SERVER: CH#50\n      WIREGUARD_PRIVATE_KEY: "ELmlNw4g9+bcC2Bjali/lzUZm2GXJNz4iRkG5JNILX4="\n    # NET_ADMIN capability is mandatory!\n    cap_add:\n      - NET_ADMIN\n    # sysctl net.ipv4.conf.all.rp_filter is mandatory!\n    sysctls:\n      net.ipv4.conf.all.rp_filter: 2\n      net.ipv6.conf.all.disable_ipv6: 1\n    volumes:\n      - /etc/localtime:/etc/localtime:ro\n    ports:\n      - 127.0.0.1:6881:6881\n      - 127.0.0.1:6881:6881/udp\n      - 127.0.0.1:10020:10020\n      - 127.0.0.1:9091:9091\n      - 127.0.0.1:51413:51413\n      - 127.0.0.1:51413:51413/udp\n    devices:\n      - /dev/net/tun:/dev/net/tun\n    \n  qbittorrent:\n    image: lscr.io/linuxserver/qbittorrent:latest\n    container_name: qbit\n    depends_on:\n      - protonwire\n    userns_mode: host\n    network_mode: service:protonwire\n    restart: unless-stopped\n    environment:\n      - PUID=0\n      - PGID=0\n      - TZ=Europe/Paris\n      - WEBUI_PORT=10020\n    volumes:\n      - /containers/qbittorrent:/config:z\n      - stockage:/stockage:z\n\n  jellyfin:\n    image: jellyfin/jellyfin\n    container_name: cagouille\n    restart: unless-stopped\n    devices:\n      - /dev/dri:/dev/dri\n    group_add:\n      - "105" # getent group render | cut -d: -f3\n    user: "1000:1000"\n    environment:\n      - TZ=Europe/Paris\n      - JELLYFIN_PublishedServerUrl="https://example.com"\n\n    volumes:\n      - /containers/jellyfin:/config:z\n      - stockage:/stockage:z\n    ports:\n      - 127.0.0.1:8096:8096\n    \nvolumes:\n  stockage:\n    driver: local\n    driver_opts:\n      type: \'none\'\n      o: \'bind\'\n      device: \'/storage\'\n')))}d.isMDXComponent=!0},4333:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/jellyfin_screen-b41fa983df622046e80a020edc2b2339.png"},2034:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/qbit-a09e6d5f68136d25efed1b3dcb0f8de5.png"},7352:(e,n,r)=>{r.d(n,{Z:()=>t});const t=r.p+"assets/images/radarr-aa7fb72b0b1f34297ba85acb1409b2fa.png"}}]);